<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ollama Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}?v={{ timestamp }}">
</head>
<body>
    <!-- Compact Mode Toggle Button -->
    <button id="compactToggle" class="compact-toggle-btn" title="Toggle Compact Mode">
        <i class="fas fa-compress"></i>
    </button>
    <button id="settingsBtn" class="compact-toggle-btn settings-btn-position" title="Settings" onclick="window.location.href='/settings'">
        <i class="fas fa-cog"></i>
    </button>

    <div class="container py-3">
        <div class="title-container text-center mb-1">
            <div class="d-flex align-items-center justify-content-center gap-2">
                <div class="title-logo-small">
                    <img src="{{ url_for('static', filename='ollama-logo.png') }}" alt="Ollama">
                </div>
                <h2 class="page-title-minimal mb-0">Ollama Dashboard</h2>
                {% if ollama_version != 'Unknown' %}
                <small class="text-muted fw-light ms-2">v{{ ollama_version }}</small>
                {% endif %}
            </div>
        </div>

        <div class="refresh-indicator mb-2 {% if error %}error{% endif %}" data-timezone="{{ timezone }}">
            <div class="dot"></div>
            <span>Last updated: <span id="lastUpdate"></span> • Next refresh in <span id="nextRefresh">30</span>s</span>
        </div>

        <!-- Health Status Indicator -->
        <div class="d-flex justify-content-center mb-2">
            <div id="healthStatus" class="badge bg-secondary health-status-badge">
                <i class="fas fa-heartbeat me-2"></i>
                <span id="healthText">Checking health...</span>
            </div>
        </div>

        <!-- Models Management Section -->
        <div class="models-section">
                <!-- Compact System Resources -->
                <div class="compact-system-resources mb-2">
                    <div class="d-flex justify-content-between align-items-center mb-1">
                        <div class="d-flex align-items-center gap-2">
                            <i class="fas fa-server text-primary section-icon"></i>
                            <span class="fw-semibold text-light section-title-text">System Resources</span>
                        </div>
                        <small class="text-muted last-update-time" id="lastUpdateTime">Updated just now</small>
                    </div>



                    <div class="compact-metrics-grid">
                        <!-- CPU -->
                        <div class="compact-metric">
                            <div class="d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center gap-1">
                                    <i class="fas fa-microchip resource-icon resource-icon-cpu"></i>
                                    <span class="metric-label-compact">CPU</span>
                                </div>
                                    <span class="metric-value-compact" id="cpuPercent">{{ system_stats.cpu_percent|round(1) }}%</span>
                            </div>
                            <canvas class="timeline-canvas" id="cpuTimeline" width="200" height="20"></canvas>
                        </div>

                        <!-- RAM -->
                        <div class="compact-metric">
                            <div class="d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center gap-1">
                                    <i class="fas fa-memory resource-icon resource-icon-ram"></i>
                                    <span class="metric-label-compact">RAM</span>
                                </div>
                                <span class="metric-value-compact" id="memoryPercent">{{ system_stats.memory.percent|round(1) }}%</span>
                            </div>
                            <canvas class="timeline-canvas" id="memoryTimeline" width="200" height="20"></canvas>
                        </div>

                        <!-- VRAM -->
                        <div class="compact-metric">
                            <div class="d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center gap-1">
                                    <i class="fas fa-palette resource-icon resource-icon-gpu"></i>
                                    <span class="metric-label-compact">VRAM</span>
                                </div>
                                <span class="metric-value-compact" id="vramPercent">{{ system_stats.vram.percent|round(1) if system_stats.vram.total > 0 else '--' }}%</span>
                            </div>
                            <canvas class="timeline-canvas" id="vramTimeline" width="200" height="20"></canvas>
                        </div>

                        <!-- Disk -->
                        <div class="compact-metric">
                            <div class="d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center gap-1">
                                    <i class="fas fa-hdd resource-icon resource-icon-disk"></i>
                                    <span class="metric-label-compact">Disk</span>
                                </div>
                                <span class="metric-value-compact" id="diskPercent">{{ system_stats.disk.percent|round(1) }}%</span>
                            </div>
                            <canvas class="timeline-canvas" id="diskTimeline" width="200" height="20"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Models Management Section -->
                <div class="models-management mt-4">
                    <!-- Running Models -->
                    {% if models %}
                    <div class="mb-4">
                        <div class="d-flex align-items-center gap-2 mb-3">
                            <i class="fas fa-play-circle text-success section-icon"></i>
                            <span class="fw-semibold text-light section-title-text">Running Models ({{ models|length }})</span>
                        </div>
                        <div class="row g-3">
                            {% for model in models %}
                            <div class="col-md-6 col-lg-4">
                                <div class="model-card h-100">
                                    <div class="model-header">
                                        <div class="model-icon-wrapper">
                                            <i class="fas fa-brain model-icon-main"></i>
                                        </div>
                                        <div class="model-meta">
                                            <span class="status-indicator running">
                                                <i class="fas fa-circle"></i>Running
                                            </span>
                                        </div>
                                    </div>
                                    <div class="model-title">{{ model.name }}</div>
                                    <div class="model-capabilities">
                                        <span class="capability-icon {{ 'enabled' if model.has_reasoning else 'disabled' }}" title="Reasoning: {{ 'Available' if model.has_reasoning else 'Not available' }}">
                                            <i class="fas fa-brain"></i>
                                        </span>
                                        <span class="capability-icon {{ 'enabled' if model.has_vision else 'disabled' }}" title="Image Processing: {{ 'Available' if model.has_vision else 'Not available' }}">
                                            <i class="fas fa-image"></i>
                                        </span>
                                        <span class="capability-icon {{ 'enabled' if model.has_tools else 'disabled' }}" title="Tool Usage: {{ 'Available' if model.has_tools else 'Not available' }}">
                                            <i class="fas fa-tools"></i>
                                        </span>
                                    </div>
                                    <div class="model-specs">
                                        <div class="spec-row compact-hide">
                                            <div class="spec-item">
                                                <div class="spec-icon">
                                                    <i class="fas fa-cogs"></i>
                                                </div>
                                                <div class="spec-content">
                                                    <div class="spec-label">Family</div>
                                                    <div class="spec-value">{{ model.families_str|default('Unknown') }}</div>
                                                </div>
                                            </div>
                                            <div class="spec-item">
                                                <div class="spec-icon">
                                                    <i class="fas fa-weight"></i>
                                                </div>
                                                <div class="spec-content">
                                                    <div class="spec-label">Parameters</div>
                                                    <div class="spec-value">{{ model.parameter_size|default('Unknown') }}</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="spec-row compact-hide">
                                            <div class="spec-item">
                                                <div class="spec-icon">
                                                    <i class="fas fa-hdd"></i>
                                                </div>
                                                <div class="spec-content">
                                                    <div class="spec-label">Size</div>
                                                    <div class="spec-value">{{ model.size|default('Unknown') }}</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="spec-row" title="System-wide usage (per-model metrics not available)">
                                            <div class="spec-item">
                                                <div class="spec-icon">
                                                    <i class="fas fa-memory"></i>
                                                </div>
                                                <div class="spec-content">
                                                    <div class="spec-label">System RAM</div>
                                                    <div class="spec-value" id="model-ram-{{ loop.index }}">Loading...</div>
                                                </div>
                                            </div>
                                            <div class="spec-item compact-hide">
                                                <div class="spec-icon">
                                                    <i class="fas fa-palette"></i>
                                                </div>
                                                <div class="spec-content">
                                                    <div class="spec-label">System VRAM</div>
                                                    <div class="spec-value" id="model-vram-{{ loop.index }}">Loading...</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="model-actions">
                                        <div class="btn-group w-100">
                                            <button class="btn btn-info" onclick="showModelInfo('{{ model.name }}')" title="View model information">
                                                <i class="fas fa-info-circle"></i> <span class="d-none d-sm-inline">Info</span>
                                            </button>
                                            <button class="btn btn-warning" onclick="stopModel('{{ model.name }}')" title="Stop model">
                                                <i class="fas fa-stop"></i> <span class="d-none d-sm-inline">Stop</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- Available Models -->
                    {% if available_models %}
                    <div class="mb-4">
                        <div class="d-flex align-items-center justify-content-between mb-3">
                            <div class="d-flex align-items-center gap-2">
                                <i class="fas fa-box text-primary section-icon"></i>
                                <span class="fw-semibold text-light section-title-text">Available Models</span>
                                <span class="badge bg-primary text-white ms-2">{{ available_models|length }}</span>
                            </div>
                            <small class="text-muted">{{ available_models|length }} model{{ available_models|length != 1 and 's' or '' }} ready to deploy</small>
                        </div>
                        <div class="row g-3">
                            {% for model in available_models %}
                            <div class="col-md-6 col-lg-4">
                                <div class="model-card h-100">
                                    <div class="model-header">
                                        <div class="model-icon-wrapper">
                                            <i class="fas fa-box model-icon-main"></i>
                                        </div>
                                        <div class="model-meta">
                                            <span class="status-indicator available">
                                                <i class="fas fa-circle"></i>Available
                                            </span>
                                        </div>
                                    </div>
                                    <div class="model-title">{{ model.name }}</div>
                                    <div class="model-capabilities">
                                        <span class="capability-icon {{ 'enabled' if model.has_reasoning else 'disabled' }}" title="Reasoning: {{ 'Available' if model.has_reasoning else 'Not available' }}">
                                            <i class="fas fa-brain"></i>
                                        </span>
                                        <span class="capability-icon {{ 'enabled' if model.has_vision else 'disabled' }}" title="Image Processing: {{ 'Available' if model.has_vision else 'Not available' }}">
                                            <i class="fas fa-image"></i>
                                        </span>
                                        <span class="capability-icon {{ 'enabled' if model.has_tools else 'disabled' }}" title="Tool Usage: {{ 'Available' if model.has_tools else 'Not available' }}">
                                            <i class="fas fa-tools"></i>
                                        </span>
                                    </div>
                                    <div class="model-specs">
                                        <div class="spec-row compact-hide">
                                            <div class="spec-item">
                                                <div class="spec-icon">
                                                    <i class="fas fa-cogs"></i>
                                                </div>
                                                <div class="spec-content">
                                                    <div class="spec-label">Family</div>
                                                    <div class="spec-value">{{ model.details.family|default('Unknown') }}</div>
                                                </div>
                                            </div>
                                            <div class="spec-item">
                                                <div class="spec-icon">
                                                    <i class="fas fa-weight"></i>
                                                </div>
                                                <div class="spec-content">
                                                    <div class="spec-label">Parameters</div>
                                                    <div class="spec-value">{{ model.details.parameter_size|default('Unknown') }}</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="spec-row compact-hide">
                                            <div class="spec-item">
                                                <div class="spec-icon">
                                                    <i class="fas fa-hdd"></i>
                                                </div>
                                                <div class="spec-content">
                                                    <div class="spec-label">Size</div>
                                                    <div class="spec-value">{{ model.size|filesizeformat if model.size else 'Unknown' }}</div>
                                                </div>
                                            </div>
                                            <div class="spec-item">
                                                <div class="spec-icon">
                                                    <i class="fas fa-memory"></i>
                                                </div>
                                                <div class="spec-content">
                                                    <div class="spec-label">System RAM</div>
                                                    <div class="spec-value" id="available-ram-{{ loop.index }}">Loading...</div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- System VRAM capacity (hidden in compact mode) -->
                                        <div class="spec-row compact-hide" title="System-wide capacities (not per model)">
                                            <div class="spec-item">
                                                <div class="spec-icon">
                                                    <i class="fas fa-palette"></i>
                                                </div>
                                                <div class="spec-content">
                                                    <div class="spec-label">System VRAM</div>
                                                    <div class="spec-value" id="available-vram-{{ loop.index }}">Loading...</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="model-actions">
                                        <button class="btn btn-success me-2" onclick="startModel('{{ model.name }}')" title="Start model" aria-label="Start model">
                                            <i class="fas fa-play"></i> <span class="d-none d-sm-inline">Start</span>
                                        </button>
                                        <button class="btn btn-info me-2" onclick="showModelInfo('{{ model.name }}')" title="View model information" aria-label="View model information">
                                            <i class="fas fa-info-circle"></i> <span class="d-none d-sm-inline">Info</span>
                                        </button>
                                        <button class="btn btn-danger" onclick="deleteModel('{{ model.name }}')" title="Delete model" aria-label="Delete model">
                                            <i class="fas fa-trash"></i> <span class="d-none d-sm-inline">Delete</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- Downloadable Models -->
                    <div class="mb-4">
                        <div class="d-flex align-items-center justify-content-between mb-3">
                            <div class="d-flex align-items-center gap-2">
                                <i class="fas fa-star text-warning icon-xs"></i>
                                <span class="fw-semibold text-light heading-xs">Best Models</span>
                            </div>
                            <small class="text-muted">Curated selection from Ollama library</small>
                        </div>
                        <div class="row g-3" id="downloadableModelsContainer">
                            <!-- Populated by JS -->
                            <div class="col-12 text-center py-4">
                                <div class="spinner-border text-secondary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                        </div>

                        <!-- View More Button -->
                        <div class="text-center mt-3">
                            <button id="viewMoreModelsBtn" class="btn btn-outline-secondary" onclick="toggleExtendedModels()">
                                <i class="fas fa-plus-circle me-2"></i>View More Models
                            </button>
                        </div>

                        <!-- Extended Models Container (hidden by default) -->
                        <div id="extendedModelsContainer" class="row g-3 mt-2 extended-models-container">
                            <!-- Populated by JS when expanded -->
                        </div>
                    </div>

                    <!-- No Models Message -->
                    {% if not models and not available_models %}
                    <div class="text-center py-5">
                        <i class="fas fa-brain fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">No Models Available</h5>
                        <p class="text-muted">No models are installed or running. Install models using Ollama CLI.</p>
                    </div>
                    {% endif %}
                </div>
        </div>

    {% if error %}
    <div class="alert alert-danger" role="alert">
        <span class="detail-icon">⚠️</span> {{ error }}
    </div>
    {% endif %}

    <script src="{{ url_for('static', filename='js/main.js') }}?v={{ timestamp }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
